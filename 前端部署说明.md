根据您提供的具体 `nginx.conf` 文件，我对部署手册进行了针对性的更新。

这份新版手册涵盖了您配置中特有的**反向代理（连接后端）**、**静态资源映射（头像上传目录）以及Assets 缓存优化**等细节。您可以直接复制到您的文档中。

---

# 前端部署说明

**文档版本**：V1.1

**适用环境**：CentOS / Ubuntu 等 Linux 发行版

**适用项目**：Vue 3 + Vite 打包项目 (挂单管理系统)

---

## 1. 环境准备：安装 Nginx

如果服务器尚未安装 Nginx，请执行以下命令：

**CentOS / RHEL 系统：**

```bash
sudo yum install epel-release -y
sudo yum install nginx -y

```

**Ubuntu / Debian 系统：**

```bash
sudo apt update
sudo apt install nginx -y

```

**启动并设置开机自启：**

```bash
sudo systemctl start nginx
sudo systemctl enable nginx

```

---

## 2. 系统目录准备 (重要)

根据您的 `nginx.conf` 配置，系统需要两个关键目录：一个是存放**前端代码**的，另一个是存放**头像/上传文件**的。需要在部署前创建好这些目录。

### 2.1 确认前端代码目录

Nginx 默认根目录通常为：`/usr/share/nginx/html`

### 2.2 创建头像/文件上传目录

您的配置中映射了 `/avatar/` 到 `/data/lodging/uploads/avatar/`，必须手动创建此目录，否则图片无法显示。

```bash
# 创建多级目录
sudo mkdir -p /data/lodging/uploads/avatar/

# 修改目录权限，确保 Nginx 有权读取和写入 (防止 403 Forbidden)
# 假设 Nginx 运行用户为 nginx (CentOS默认) 或 www-data (Ubuntu默认)
sudo chown -R nginx:nginx /data/lodging/
sudo chmod -R 755 /data/lodging/

```

---

## 3. 前端项目打包与上传

### 3.1 本地打包

在本地开发环境项目根目录下执行：

```bash
npm run build

```

打包成功后会生成 `dist` 文件夹。

### 3.2 上传文件

将本地 `dist` 文件夹内的**所有文件**上传至服务器的 `/usr/share/nginx/html` 目录。

**使用 SCP 命令示例：**

```bash
scp -r ./dist/* root@您的服务器IP:/usr/share/nginx/html/

```

*(也可以使用 XShell、FinalShell 等工具直接拖拽上传)*

---

## 4. 配置 Nginx

### 4.1 编辑配置文件

使用文本编辑器打开 Nginx 主配置文件：

```bash
vim /etc/nginx/nginx.conf

```

### 4.2 写入配置内容

**清空原文件内容**，将以下配置完整粘贴进去：

```nginx
# 运行用户 (CentOS 通常是 nginx，Ubuntu 通常是 www-data)
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# 动态模块加载
include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # 加载 conf.d 下的其他配置 (如果有)
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80;
        listen       [::]:80;
        server_name  _; # 匹配所有域名和IP
        
        # 前端代码根目录
        root         /usr/share/nginx/html;

        # 加载默认配置
        include /etc/nginx/default.d/*.conf;

        # 错误页面配置
        error_page 404 /404.html;
            location = /404.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }

        # 【核心配置 1】头像/文件静态资源映射
        # 访问 http://IP/avatar/xxx.jpg -> 读取 /data/lodging/uploads/avatar/xxx.jpg
        location /avatar/ {
            alias /data/lodging/uploads/avatar/;
        }

        # 【核心配置 2】后端接口反向代理
        # 前端请求 /lodging/xxx -> 转发给 http://49.232.241.94:8080/lodging/xxx
        location /lodging {
          proxy_pass http://49.232.241.94:8080/lodging;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
        }

        # 【核心配置 3】前端路由支持 (SPA)
        # 防止刷新页面 404
        location / {
            try_files $uri $uri/ /index.html;
        }

        # 【核心配置 4】静态资源缓存优化
        # 针对 assets 目录下的文件设置 1 年缓存
        location ^~ /assets/ {
            try_files $uri =404;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}

```

---

## 5. 重启与验证

### 5.1 检查配置语法

在重启前务必检查语法是否正确：

```bash
nginx -t

```

* **成功**：显示 `syntax is ok` 和 `test is successful`。
* **失败**：根据提示检查括号是否闭合或路径是否存在。

### 5.2 重启 Nginx

```bash
sudo systemctl restart nginx
# 或使用重载命令
sudo nginx -s reload

```

---

## 6. 部署验证清单

1. **前端页面访问**：
* 在浏览器输入服务器 IP，应能看到登录页或首页。
* 尝试刷新非首页页面，不应出现 404 错误。


2. **后端接口连通性**：
* 打开浏览器控制台 (F12) -> Network。
* 进行登录或查询操作，查看以 `/lodging` 开头的请求是否成功 (Status 200)。
* *注意：如果报错 502 Bad Gateway，说明 Nginx 无法连接到 `49.232.241.94:8080`，需检查后端服务器防火墙。*


3. **头像/图片显示**：
* 上传一张图片或查看现有头像。
* 如果图片裂开 (404/403)，请重新检查 **步骤 2.2** 中的目录是否存在以及权限是否为 755。